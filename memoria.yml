- name: Playbook de prueba  
  hosts: win19
  
  tasks:
        
  - name: Comprobando que el sistema es Server 2019
    win_command: cmd.exe /c systeminfo | find /i "Sistema Operativo"
    register: version
    failed_when: "'Windows Server 2019' not in version.stdout"
    changed_when: False
    
    
  - name: Comprobando valor variable de entorno
    win_command: cmd.exe /c SET BLUENCE_HOME
    register: HDD

  - name: Ver variable
    debug: var=HDD
    
  - name: Guardar memoria en txt
    ansible.windows.win_powershell:
      script: |
        Get-Volume -DriveLetter C | Select-Object SizeRemaining > C:\Users\Administrador\Desktop\memoria.txt
    
  - name: Modificar memoria.txt
    ansible.windows.win_powershell:
      script: |
        (get-content C:\Users\Administrador\Desktop\memoria.txt) | foreach-object {$_ -replace "SizeRemaining", ""} | set-content C:\Users\Administrador\Desktop\memoria.txt
  
  - name: Modificar memoria.txt
    ansible.windows.win_powershell:
      script: |
        (get-content C:\Users\Administrador\Desktop\memoria.txt) | foreach-object {$_ -replace "-", ""} | set-content C:\Users\Administrador\Desktop\memoria.txt
    
  - name: Guardar contenido en variable
    win_command: cmd.exe /c type C:\Users\Administrador\Desktop\memoria.txt
    register: memory
    failed_when: memory.stdout > 2048

  - name: Ver variable
    debug: var=memory
